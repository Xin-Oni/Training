# セットアップガイド

このガイドでは、ドクターヘリ物品チェックリストアプリのセットアップ手順を詳しく説明します。

## 必要なもの

- Mac（macOS 12.0 以降）
- Xcode 13.0 以降
- Google アカウント
- iOS デバイス（iOS 15.0 以降）または iOS シミュレーター

## ステップ1: プロジェクトのセットアップ

### 1.1 リポジトリのクローン

```bash
git clone <リポジトリURL>
cd Training/DoctorHeliChecklistApp
```

### 1.2 Xcode でプロジェクトを開く

```bash
open DoctorHeliChecklistApp.xcodeproj
```

または、Finder から `DoctorHeliChecklistApp.xcodeproj` をダブルクリックします。

### 1.3 ビルド設定の確認

1. Xcode でプロジェクトを開く
2. プロジェクトナビゲーターでプロジェクトファイルを選択
3. 「Signing & Capabilities」タブを選択
4. 「Team」を選択（Apple Developer アカウントが必要）
5. Bundle Identifier が一意であることを確認

## ステップ2: Google Sheets の設定

### 2.1 スプレッドシートの作成

1. [Google Sheets](https://sheets.google.com) を開く
2. 「＋」ボタンで新しいスプレッドシートを作成
3. スプレッドシート名を「ドクターヘリ物品チェックリスト」に変更

### 2.2 列の設定

以下のヘッダーを1行目に入力：

| A | B | C | D | E | F | G | H |
|---|---|---|---|---|---|---|---|
| 物品名 | カテゴリ | チェック状態 | 使用期限 | 数量 | 保管場所 | 備考 | 最終チェック日時 |

### 2.3 サンプルデータの入力

`Resources/SpreadsheetTemplate.csv` の内容をコピーして、スプレッドシートに貼り付けます。

または、以下のサンプルデータを手動で入力：

```
エピネフリン注射液,医薬品,,2025/06/01,5,救急薬品箱A,アナフィラキシーショック用,
生理食塩水500ml,医薬品,✓,2027/01/15,10,輸液保管庫,,2025/11/09
AED,医療機器,✓,2025/11/24,1,機内右側,バッテリーチェック必要,2025/11/09
```

### 2.4 スプレッドシートIDの取得

1. スプレッドシートのURLを確認：
   ```
   https://docs.google.com/spreadsheets/d/1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms/edit
   ```
2. URLの `/d/` と `/edit` の間の文字列がスプレッドシートID：
   ```
   1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms
   ```
3. このIDをメモしておく

### 2.5 共有設定

1. 右上の「共有」ボタンをクリック
2. 「制限付き」→「リンクを知っている全員」に変更
3. 権限を「編集者」に設定（アプリから更新する場合）
4. 「完了」をクリック

**重要**: 「リンクを知っている全員」に設定しないと、アプリからアクセスできません。

## ステップ3: Google Cloud Platform の設定

### 3.1 プロジェクトの作成

1. [Google Cloud Console](https://console.cloud.google.com/) にアクセス
2. 左上のプロジェクト選択をクリック
3. 「新しいプロジェクト」をクリック
4. プロジェクト名を入力（例：doctor-heli-checklist）
5. 「作成」をクリック

### 3.2 Google Sheets API の有効化

1. サイドメニューから「APIとサービス」→「ライブラリ」を選択
2. 検索バーに「Google Sheets API」と入力
3. 「Google Sheets API」をクリック
4. 「有効にする」をクリック

### 3.3 API キーの作成

1. サイドメニューから「APIとサービス」→「認証情報」を選択
2. 「認証情報を作成」→「APIキー」をクリック
3. APIキーが作成されるので、コピーしてメモ
4. （推奨）「キーを制限」をクリックして制限を設定：

#### アプリケーションの制限:
- 「iOS アプリ」を選択
- Bundle ID を入力：`com.doctorhelichecklist.app`

#### API の制限:
- 「キーを制限」を選択
- 「Google Sheets API」にチェック

5. 「保存」をクリック

### 3.4 セキュリティ確認

⚠️ **重要なセキュリティ注意事項**:

- APIキーは第三者に公開しないでください
- 本番環境では OAuth 2.0 の使用を推奨
- 定期的にAPIキーをローテーション
- 使用量の監視を有効化

## ステップ4: アプリの設定

### 4.1 アプリのビルドと実行

1. Xcode でデバイスまたはシミュレーターを選択
2. ⌘+R でアプリをビルド・実行
3. アプリが起動することを確認

### 4.2 Google Sheets との連携設定

1. アプリ右上の⚙️（設定アイコン）をタップ
2. 「スプレッドシートID」フィールドに、ステップ2.4 で取得したIDを入力
3. 「APIキー」フィールドに、ステップ3.3 で取得したAPIキーを入力
4. 「保存」ボタンをタップ
5. 「設定を保存しました」というアラートが表示されることを確認
6. 「OK」をタップして設定画面を閉じる

### 4.3 動作確認

1. メイン画面に戻る
2. 右上の🔄（更新アイコン）をタップ
3. 「最終同期」の表示が更新されることを確認
4. スプレッドシートのデータが表示されることを確認

## ステップ5: 動作テスト

### 5.1 チェック機能のテスト

1. リストから任意のアイテムの○アイコンをタップ
2. アイコンが✓に変わることを確認
3. Google Sheets を開いて、該当行の「チェック状態」列に✓が追加されていることを確認

### 5.2 編集機能のテスト

1. リストから任意のアイテムをタップして詳細画面を開く
2. 数量を変更
3. 使用期限を設定
4. 「保存」をタップ
5. Google Sheets で変更が反映されていることを確認

### 5.3 追加機能のテスト

1. 右上の＋アイコンをタップ
2. 新しい物品の情報を入力
3. 「追加」をタップ
4. リストに新しいアイテムが表示されることを確認
5. Google Sheets に新しい行が追加されることを確認

## トラブルシューティング

### 問題: スプレッドシートに接続できない

**解決方法**:
1. スプレッドシートIDが正しいか再確認
2. APIキーが正しいか再確認
3. スプレッドシートの共有設定を確認（「リンクを知っている全員」）
4. Google Sheets API が有効になっているか確認
5. インターネット接続を確認

### 問題: データが同期されない

**解決方法**:
1. 手動で同期ボタン（🔄）をタップ
2. アプリを完全に終了して再起動
3. スプレッドシートの形式が正しいか確認
4. APIキーの制限設定を確認

### 問題: ビルドエラーが発生する

**解決方法**:
1. Xcode のバージョンを確認（13.0以降）
2. Product → Clean Build Folder を実行
3. Derived Data を削除：
   ```bash
   rm -rf ~/Library/Developer/Xcode/DerivedData
   ```
4. プロジェクトを閉じて再度開く

### 問題: 使用期限が正しく表示されない

**解決方法**:
1. スプレッドシートの日付形式を確認（yyyy/MM/dd）
2. 正しい例：`2025/12/31`
3. 誤った例：`12/31/2025`、`2025-12-31`

### 問題: APIキーのエラー

**エラーメッセージ**: "API key not valid"

**解決方法**:
1. Cloud Console で APIキーの制限を確認
2. 制限が厳しすぎる場合は一時的に「なし」に設定してテスト
3. Bundle ID が正しく設定されているか確認

## 本番環境への展開

### App Store への提出準備

1. **アイコンの作成**:
   - 1024x1024 のアプリアイコンを作成
   - Assets.xcassets に追加

2. **スクリーンショットの準備**:
   - 各デバイスサイズのスクリーンショットを撮影
   - App Store Connect にアップロード

3. **プライバシーポリシーの作成**:
   - Google Sheets APIの使用について明記
   - データの取り扱いについて説明

4. **テストフライトでのベータテスト**:
   - 内部テスターを招待
   - フィードバックを収集

### セキュリティ強化

本番環境では以下の対策を推奨：

1. **OAuth 2.0 の実装**:
   - APIキーではなく OAuth 2.0 を使用
   - ユーザーごとのアクセス制御

2. **サーバーサイドの実装**:
   - APIキーをアプリに埋め込まない
   - バックエンドサーバー経由でアクセス

3. **データの暗号化**:
   - ローカルストレージの暗号化
   - 通信の TLS/SSL 強化

## 追加リソース

- [Google Sheets API ドキュメント](https://developers.google.com/sheets/api)
- [SwiftUI チュートリアル](https://developer.apple.com/tutorials/swiftui)
- [iOS Human Interface Guidelines](https://developer.apple.com/design/human-interface-guidelines/ios)

## サポート

問題が解決しない場合は、以下を確認してください：

1. README.md のトラブルシューティングセクション
2. プロジェクトの GitHub Issues
3. Google Sheets API のステータスページ

---

セットアップが完了したら、実際の運用環境でテストを行ってください。
